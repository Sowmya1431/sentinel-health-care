<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Analytics | Sentinel Health</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      :root{
        --bg:#f3f6fb;
        --card:#ffffff;
        --accent:#5a4fd6;
        --muted:#7b8090;
        --border:#e8ebf3;
      }
      * { box-sizing: border-box; margin:0; padding:0; }
      html,body{height:100%;font-family:Inter, "Roboto", system-ui, "Segoe UI", Arial;background:var(--bg);color:#111}
      a{color:inherit;text-decoration:none}

      .sidebar { width: 260px; height: 100vh; background: var(--card); position: fixed; left: 0; top: 0; padding: 28px 18px; border-right: 1px solid #eceff6; display: flex; flex-direction: column; align-items: flex-start; gap: 18px; box-shadow: 3px 0 15px rgba(0,0,0,0.03); }
      .logo-container { display:flex; align-items:center; gap:12px; width:100% }
      .logo-container img{ width:44px; height:44px; border-radius:10px; object-fit:cover }
      .logo-container h1{ font-size:18px; color:var(--accent); margin:0; font-weight:800 }

      .nav-item { width:100%; padding:12px 16px; display:block; color:#333; font-size:15px; border-radius:12px; transition: all .16s ease; font-weight:700; background:transparent; cursor:pointer; text-align:center; }
      .nav-item:hover { background: rgba(90,79,214,0.06); color:var(--accent); transform: translateY(-2px) }
      .nav-item.active { background: linear-gradient(90deg, rgba(90,79,214,0.06), rgba(90,79,214,0.02)); color:var(--accent); box-shadow: 0 6px 18px rgba(75,44,224,0.04) }

      .content { margin-left: 300px; padding: 40px; }
      .card { background: var(--card); padding: 30px; border-radius: 14px; box-shadow: 0 8px 30px rgba(21,24,40,0.04); margin-bottom:30px; border:1px solid var(--border); }
      h1 { font-size:28px; margin-bottom:30px; }
      h3 { font-size:18px; margin-bottom:10px; color:var(--muted); }
      #totalFalls { font-size:48px; font-weight:800; color:var(--accent); }
      canvas { max-width:100%; }
    </style>
  </head>
  <body>
    <!-- Sidebar -->
    <div class="sidebar">
      <div class="logo-container">
        <img src="{{ url_for('static', filename='images/logo1.png') }}" alt="logo" />
        <h1>Sentinel Health</h1>
      </div>
      <a class="nav-item" href="{{ url_for('about') }}">About</a>
      <a class="nav-item" href="{{ url_for('upload_page') }}">Upload Video</a>
      <a class="nav-item active" href="{{ url_for('analytics') }}">Analytics</a>
      <a class="nav-item" href="{{ url_for('admin_panel') }}">Admin Panel</a>
      <a class="nav-item" href="{{ url_for('logout') }}">Logout</a>
    </div>

    <!-- Main Content -->
    <main class="content">
      <h1>Analytics Dashboard</h1>
      <div class="card">
        <h3>Total Falls Detected</h3>
        <p id="totalFalls">0</p>
      </div>

      <div class="card">
        <canvas id="trendChart" width="600" height="200"></canvas>
      </div>
    </main>

    <script>
      async function refresh(){
        try{
          const r = await fetch('{{ url_for("api_analytics") }}');
          const j = await r.json();
          document.getElementById('totalFalls').innerText = j.fall_count || 0;
          const ctx = document.getElementById('trendChart').getContext('2d');
          new Chart(ctx, {
            type: 'bar',
            data: {
              labels: ['Falls'],
              datasets: [{label: 'Count', data: [j.fall_count || 0], backgroundColor: ['#5a4fd6']}]
            },
            options: {
              responsive: true,
              plugins: {
                title: { display: true, text: 'Fall Detection Statistics' }
              }
            }
          });
        }catch(e){console.warn(e)}
      }
      refresh();
    </script>
  </body>
</html>
